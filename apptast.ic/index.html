<html>
<head>
<title>Apptast.ic</title>
<style>
body {
  background:#f7f4f4 url("static/apptastic.jpg") no-repeat left top;
}
#form {
  position:absolute;
  left:250px;
  top:200px;
  font:16pt "Gill Sans",Arial,sans-serif;
}
#form div {
  margin-bottom:16px;
}
#inputfield {
  width:400px;
}
#button {
  margin-top:16px;
  width:200px;
  font:14pt "Gill Sans",Arial,sans-serif;
}

#form div {
  margin-bottom:16px;
}
.button {
  margin-top:16px;
  width:300px;
  font:14pt "Gill Sans",Arial,sans-serif;
}
.appbox {
  position:relative;
}
.app {
  width:140px;
  height:140px;
  position:relative;
  background-color:white;
  border:1px solid #808080;
  -moz-border-radius:8px;
}
.app .icon {
  width:48px;
  height:48px;
  margin:auto;
  margin-top:24px;
}
.app .name {
  width:130px;
  margin:auto;
  border:none;
}
.appname {
    border: 1px solid black;
  background-color:#f0f0f0;
  text-align:center;
  width:128px 
}
.pointer {
  position:absolute;
  top:85px;
  left:145px;
  width:200px;
  font:8pt sans-serif;
}
</style>
<script src="js/jquery-1.4.2.min.js"></script> 
<script src="https://myapps.mozillalabs.com/jsapi/include.js"></script> 
</head>
<body>

<div id="form">
<div id="actionArea">
<div>turn any website into an app.</div>

<div>just enter a website address here:</div>

  <form id="whereInput">
  <input id="inputfield" type="text" name="url" placeholder="http://somewebsite.com"><br>
  <input id="button" type="submit" value="make it apptastic!">
  </form>
</div>

</div>
</body>

<script type="text/javascript"> 

$(document).ready(function() {
    var manifest = null;

    function doInstall()
    {
        AppClient.install({manifest:manifest, callback:function(arg) {
            alert("application installed!");
        }});
    }

    function gotManifest(manifestContent) {
        manifest = manifestContent;
        $("#actionArea").empty().append(
            $("<div/>").text("Shazam!  And then there was an application:"));

        // include application display
        var app = $('<div class="app">');
        app.append($('<div class="icon"><img width="48" height="48" src="' + manifest.icons["48"] + '"</div></div>"'));
        app.append($('<div class="name"><input id="nameMod" class="appname" type="text"'
                     + ' name="name" id="appname" value="' + manifest["name"] + '"></div>'));
        $("#actionArea").append(app);

        // update manifest as the user does.
        $("#nameMod").keyup(function() { manifest["name"] = $("#nameMod").val(); });

        // action buttons
        $("#actionArea").append($('<button id="installButton" class="button">install app into my browser</button><br>'));
        $("#actionArea").append($('<button onclick="document.location=\'/\'" class="button">make another app</button>'));
        $("#installButton").click(doInstall);
    }

    $("#whereInput").submit(function(eo) {
        // first we'll change the UI to indicate that we're
        // working on it..
        var url = $("#inputfield").val();
        
        // XXX: handle invalid urls

        $("#actionArea").empty().append(
            $("<div/>").text("Making a custom application just for you (from "+url+")..."));
        
        $.getJSON("/api/make_app?url=" + url, function(data, textStatus) { gotManifest(data); });
        eo.preventDefault();
    });
})  
</script> 
</html>


