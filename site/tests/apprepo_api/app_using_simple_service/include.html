<!DOCTYPE html>

<script src="/servers.js"></script>
<script src="/jschannel.js"></script>
<script>

function myonload() {
    // update repo origin for the test environment
    navigator.apps.setRepoOrigin(SERVERS['_primary']);

    var chan = Channel.build({
      window: window.parent,
      origin: "*",
      scope: "test"
    });

    chan.bind("profile.get", function(trans, p) {
        trans.delayReturn(true);
        navigator.apps.invokeService(
            "profile.get", null,
            function(v) { trans.complete(v); },
            function(errObj) { trans.error(errObj.code, errObj.message) }
        );
    });
}

// a tricky bit here, we need to include the repo API js.  Well wait
// to bind our JSChannel until the browser decides to load it.  -->
var includeJsURL = SERVERS['_primary'] + "/jsapi/include.js";
var scriptTag = document.createElement("script");
scriptTag.src = includeJsURL;
scriptTag.onreadystatechange = function () {
    if (this.readyState == 'complete') myonload();
};
scriptTag.onload = myonload;
document.getElementsByTagName('head')[0].appendChild(scriptTag);

</script>


