<html>
<head>
<style>
HTML {
  background-color: transparent;
}

BODY {
  margin: 0 3px;
  color:white;
  font: message-box;
  height:232px;
  background-color: transparent;
  -moz-border-image: url(chrome://openwebapps/skin/hud-panel.png) 26 50 22 18 / 26px 50px 22px 18px repeat;
}
.appName {
  color:#d0e8ff;
  font-weight:bold;
}
.headline {
  font-size:1.2em;
  margin-bottom:16px;
}
.body {
}

.app {
	float: left;
	position: relative;
	margin: 0px 5px 30px 5px;
}

.appName{
	color: rgb(220,220,220);
	font-family:Tahoma, sans-serif !important;
	width: 100%;
  font-weight:bold;
	font-size: 10px;
	line-height: 12px;
	top: 116px;
  width:60px;
	text-align: center;
	margin: auto;
  cursor:default;
}

.appList {
	background: rgba(0,0,0);

	-moz-border-radius: 1em;
	border-radius: 1em;

	background-color: rgb(220,220,220);

   -moz-box-shadow:  0 0 2px black;
        box-shadow:  0 0 2px black;
		
}

.appList:after { content: "."; display: block; height: 0; clear: both; visibility: hidden; }

.icon {
	position: relative;
	width: 48px;
	height: 48px;
	text-align: center;
	background-image: url('img/default-icon.png');
	margin: 10px;
}

.icon a {
    display: block;
	position: absolute;
	width: 96px;
	height: 96px;
	font-size: 1.2em;
	color: rgb(255,255,255);
	text-decoration: none;
	-moz-transition: all 1s ease-out;  /* FF3.7+ */

 	opacity: 0;

}



</style>
</head>
<body>
<div id="icon_region"></div>
<script>
var container = document.getElementById("icon_region");
Components.utils.import("resource://openwebapps/modules/api.js");
var repo = new FFRepoImpl();

var appList = repo.list(); // XXX This will become asynchronous.
var container = document.getElementById("icon_region");
for (var i=0;i<appList.length;i++) {
  
  container.appendChild(createAppIcon(appList[i]));
}

function elem(type, clazz) {
  var e = document.createElement(type);
  if (clazz) e.setAttribute("class", clazz);
  return e;
}

function getBiggestIcon(minifest) {
  //see if the minifest has any icons, and if so, return the largest one
  if (minifest.icons) {
    var biggest = 0;
    for (z in minifest.icons) {
      var size = parseInt(z, 10);
      if (size > biggest) biggest = size;
    }
    if (biggest !== 0) return minifest.icons[biggest];
  }
  return null;
}

function createAppIcon(app)
{
  //we will make an 'appDiv', which contains all the parts.
  // it will have an icon and a title, in default mode.
  // if the app has a widget enabled, it will be larger, visible, and have an iframe
  // next to the app icon and title.  the iframe has a default size, but can be
  // made larger if the widget specifies it, up to some reasonable maximum
  var appContainer = elem("div", "app");
  
  var clickyIcon = elem("div", "icon");
  var iconImg = getBiggestIcon(app);
  if (iconImg) {
      clickyIcon.style.background = "url(\"" + iconImg + "\") no-repeat #000000";
      clickyIcon.style.backgroundSize = "100%";
  }
  clickyIcon.onclick = function() { repo.launch(null, app.id); };
  appContainer.appendChild(clickyIcon);

  var appName = elem("div", "appName");
  appName.appendChild(document.createTextNode(app.name));
  
  appName.style.left = "10px";
  appContainer.appendChild(appName);
  return appContainer;
}



</script>
</body>
</html>