<html>
<head>
<link rel="stylesheet" href="resource://openwebapps/chrome/skin/popup.css">
</head>
<body>

<div id="manage">
    <div id="empty"></div>
    <a href="#" style="cursor:pointer" id="about_apps">Manage Apps</a>
</div>

<div id="offer_region">
    <div id="offer_intro">This web site has an installable web application:</div>
    <div id="offer_details">
        <!-- <div id="offer_close"><div id="offer_close_button"></div></div> -->
        <div id="offer_icon"></div>
        <div style="display:inline-block;width:300px">
            <div id="offer_name"></div>
            <div id="offer_desc"></div>
            <div id="install_status"></div>
        </div>
        <div id="offer_controls">
            <button id="offer_install">INSTALL</button>
        </div>
    </div>
</div>
<div id="icon_region"></div>
</body>

<script>
/*
if (repo.getCurrentPageHasApp())
{
    repo.getCurrentPageApp(function(currentPageApp) {
    
        try {
        
            if (currentPageApp) {
                var wm = Components.classes["@mozilla.org/appshell/window-mediator;1"]
                                                         .getService(Components.interfaces.nsIWindowMediator);
                var recentWindow = wm.getMostRecentWindow("navigator:browser");
                    
                var offer_region = document.getElementById("offer_region");
                offer_region.style.display = "block";
                var offer_name = document.getElementById("offer_name");
                offer_name.appendChild(document.createTextNode(currentPageApp.name));

                var offer_icon = document.getElementById("offer_icon");
                var iconImg = getBiggestIcon(currentPageApp);
                var iconUrl = recentWindow.gBrowser.contentDocument.baseURI + iconImg;
                
                offer_icon.style.background = "url(\"" + iconUrl + "\") no-repeat";
                offer_icon.style.backgroundSize = "100%";

                var offer_desc = document.getElementById("offer_desc");
                if (currentPageApp.description) {
                    offer_desc.appendChild(document.createTextNode(currentPageApp.description));
                }
                document.getElementById("offer_install").onclick = function() {
                    
                    var installArgs = 
                        {
                            url: repo.getCurrentPageAppManifestURL().spec, 
                            onerror:function(result) {
                                document.getElementById("install_status").appendChild(document.createTextNode("Error: " + result.message));
                            },
                            onsuccess:function(result) {
                                // should animate something cool happening here. :)
                                repo.list(function(appDict) {
                                    wiggleInstalled = repo.getCurrentPageAppManifestURL().spec;
                                    renderIconList(appDict, repo.getCurrentPageAppManifestURL());

                                    var off_region = document.getElementById("offer_region");
                                    off_region.style.opacity = 0;
                                    off_region.style.height = off_region.clientHeight + "px";
                                    document.getElementById("icon_region").style.top = off_region.clientHeight + "px";
                                    window.setTimeout(function() {
                                        off_region.style.height = "0px";
                                    }, 500);
                                });
                            }
                        };
                    repo.install(window.location, installArgs, recentWindow);
                }
            }
        } catch (e) {
            dump("Error with current page app: " + e + "\n");
        }
    });
}
*/
</script>
</html>